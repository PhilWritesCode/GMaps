(function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("meetupApp",["AngularGM","ngGPlaces","ngRoute","ngAutocomplete"]),e.factory("locationService",function(){return this.geocoder=new google.maps.Geocoder,this.searcher=new google.maps.places.PlacesService(document.getElementById("results")),this.processLocation=function(e){return function(t,n,s){return e.geocoder.geocode({address:t,location:n},function(e,t){return t===google.maps.GeocoderStatus.OK?s(e[0]):t===google.maps.GeocoderStatus.ZERO_RESULTS?alert("Location not found!  Please try again, or add a different location."):t===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?alert("Website is over query limit.  Please contact me at philip.t.jenkins@gmail.com"):t===google.maps.GeocoderStatus.REQUEST_DENIED?alert("Request denied.  Please contact me at philip.t.jenkins@gmail.com"):alert("Unknown Error.  Please check your internet connection and try again.")})}}(this),this.performSearch=function(e){return function(t,n,s,i){return e.searcher.textSearch({query:n,location:t,radius:5},function(e,t,n){return t===google.maps.places.PlacesServiceStatus.OK?s(e,n):t===google.maps.places.PlacesServiceStatus.ZERO_RESULTS?(alert("No results found!  Please enter a different search term."),i()):t===google.maps.places.PlacesServiceStatus.INVALID_REQUEST?(alert("Invalid request.  Please check search term and try again."),i()):t===google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT?(alert("Website is over query limit.  Please contact me at philip.t.jenkins@gmail.com"),i()):t===google.maps.GeocoderStatus.REQUEST_DENIED?(alert("Request denied.  Please contact me at philip.t.jenkins@gmail.com"),i()):(alert("Unknown Error.  Please check your internet connection and try again."),i())})}}(this),this.getLocationDetails=function(e){return function(t,n){return e.searcher.getDetails({placeId:t},function(e,t){return t!==google.maps.places.PlacesServiceStatus.OK?void console.log("error fetching location details."):n(e)})}}(this),{processLocation:this.processLocation,performSearch:this.performSearch,getLocationDetails:this.getLocationDetails}}),e.controller("MeetupController",["$scope","$location","$anchorScroll","$routeParams","locationService",function(e,n,s,i,o){var r,a,c,h;return this.locationMarkers=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this.clickDisablingNodes=["SELECT","A","INPUT"],this.locations=[],this.bounds=new google.maps.LatLngBounds,this.centerOfSearchArea,this.locationFormEntry,this.searchTerm="coffee",this.markerEvents,this.searchPages=[],this.searchPageIndex=0,this.searchPaginationObject,a=[],this.processLocationFormEntry=function(){return this.locationFormEntry&&o.processLocation(this.locationFormEntry,this.centerOfSearchArea,this.addLocation),this.locationFormEntry=""},this.addLocation=function(t){return function(n){return t.locationAlreadyEntered(n)?void 0:(t.locations.push(n),t.updateMapLocations(),t.performSearch(),e.$apply())}}(this),c=function(e){return function(){return e.locationFormEntry=a.pop(),e.processLocationFormEntry()}}(this),this.locationAlreadyEntered=function(e){var t,n,s,i;for(i=this.locations,n=0,s=i.length;s>n;n++)if(t=i[n],t.formatted_address===e.formatted_address)return!0;return!1},this.removeLocation=function(e){return this.locations.splice(this.locations.indexOf(e),1),this.updateMapLocations(),this.performSearch()},this.updateMapLocations=function(e){return function(){var t,n,s,i;if(e.locations.length>0)for(e.bounds=new google.maps.LatLngBounds,i=e.locations,n=0,s=i.length;s>n;n++)t=i[n],e.bounds.extend(t.geometry.location);return e.centerOfSearchArea=e.bounds.getCenter()}}(this),this.updateMapSearchResults=function(e){return function(){var t,n,s,i,o,r,a,c,h;if(e.getDisplayedResults().length>0){for(e.bounds=new google.maps.LatLngBounds,a=e.locations,s=0,o=a.length;o>s;s++)t=a[s],e.bounds.extend(t.geometry.location);for(c=e.getDisplayedResults(),h=[],i=0,r=c.length;r>i;i++)n=c[i],h.push(e.bounds.extend(n.geometry.location));return h}}}(this),this.updateSearchArea=function(e,t){return this.centerOfSearchArea=t.getPosition(),this.performSearch()},this.performSearch=function(e){return function(){return e.searchPages=[],e.searchPageIndex=0,e.searchTerm&&0!==e.locations.length?o.performSearch(e.centerOfSearchArea,e.searchTerm,e.displayResults,h):void h()}}(this),this.displayResults=function(t){return function(n,s){return t.searchPaginationObject=s,t.searchPages.push(n.slice(0,10)),n.length>10&&t.searchPages.push(n.slice(10)),t.searchPages.length>2&&t.searchPageIndex++,t.updateMapSearchResults(),e.$apply(),a.length>0?c():void 0}}(this),h=function(t){return function(){return e.$broadcast("gmMarkersUpdate","meetup.getDisplayedResults()")}}(this),this.getDisplayedResults=function(){return this.searchPages[this.searchPageIndex]},this.addLocationDetail=function(t){return function(n){var s,i,o,r;for(r=t.getDisplayedResults(),i=0,o=r.length;o>i;i++)if(s=r[i],s.place_id===n.place_id){s.reviews=n.reviews,s.formatted_phone_number=n.formatted_phone_number,s.url=n.url,s.website=n.website,s.opening_hours=n.opening_hours;break}return e.$apply(),h()}}(this),this.getLocationId=function(e){return this.locationMarkers[this.locations.indexOf(e)]},this.getBaseUrl=function(e){var t;return e?(t=e.split("/"),t[2]):void 0},this.selectResult=function(e){var t,n,s,i;for(void 0===e.website&&o.getLocationDetails(e.place_id,this.addLocationDetail),i=this.getDisplayedResults(),n=0,s=i.length;s>n;n++)t=i[n],t.selected=!1;return e.selected=!0,h()},this.deSelectResult=function(e){return e.selected=!1,h()},this.highlightResult=function(e){return e.highlighted=!0,h()},this.unHighlightResult=function(e){return e.highlighted=!1,h()},this.toggleSelection=function(e){return e.selected?(this.deSelectResult(e),this.triggerCloseResultsInfoWindow(e)):(this.selectResult(e),this.triggerOpenResultsInfoWindow(e))},this.handleTextEntryClicked=function(e,n){var s;return s=n.target.nodeName,t.call(this.clickDisablingNodes,s)>=0?void 0:this.toggleSelection(e)},this.triggerOpenResultsInfoWindow=function(e){return this.markerEvents=[{event:"openresultsinfowindow",ids:["result"+e.place_id]}]},this.triggerCloseResultsInfoWindow=function(e){return this.markerEvents=[{event:"closeresultsinfowindow",ids:["result"+e.place_id]}]},this.getNormalizedAddress=function(e){var t;return e?(t=e.formatted_address,t.indexOf(", USA")>0?t.substr(0,t.indexOf(", USA")):t.indexOf(", United States")>0?t.substr(0,t.indexOf(", United States")):t):void 0},this.nextPageAvailable=function(){return this.searchPages.length-1>this.searchPageIndex||this.searchPaginationObject&&this.searchPaginationObject.hasNextPage},this.getSearchResultPageNumbers=function(){return this.getDisplayedResults()?10*this.searchPageIndex+1+" - "+(10*this.searchPageIndex+this.getDisplayedResults().length):void 0},this.getPreviousPage=function(){return this.searchPageIndex>0?(this.searchPageIndex--,this.updateMapSearchResults()):void 0},this.getNextPage=function(){return this.searchPages.length-1>this.searchPageIndex?(this.searchPageIndex++,this.updateMapSearchResults()):this.searchPaginationObject.hasNextPage?this.searchPaginationObject.nextPage():void 0},this.getPageTitle=function(){return r()?"HalfwayHangout":"MidwayMeetup"},this.getPageSubTitle=function(){return r()?"Where do you want to hang out?":"Where do you want to meet up?"},this.getMeetupNomenclature=function(){return r()?"hang out":"meet up"},this.getFavIcon=function(){return r()?"img/hangout.ico":"img/meetup.ico"},r=function(){return window.location.host.indexOf("halfwayhangout.com")>=0},this.getLocationPlaceholder=function(){return this.locations.length>0?"Enter another address...":"Enter a starting address"},this.scrollTo=function(e){return n.hash(e),s()},this.initController=function(){var e,t;return t=n.search(),e=i,t.search&&(this.searchTerm=t.search),t.locations?(a=t.locations.split(":"),c()):void 0},this.generatePermalink=function(){return n.host()+"?search="+this.searchTerm+"&locations="+this.locationsToDelimitedString()},this.locationsToDelimitedString=function(){var e,t,n,s,i;for(t="",i=this.locations,n=0,s=i.length;s>n;n++)e=i[n],t+=this.getNormalizedAddress(e)+":";return t.slice(0,-1)},this.getMapLocationOptions=function(e){return angular.extend(this.mapLocationOptions,{icon:"http://maps.google.com/mapfiles/marker_grey"+this.locationMarkers[this.locations.indexOf(e)]+".png"})},this.getMapSearchAreaOptions=function(){return this.locations.length>0?this.mapSearchAreaOptions:this.mapHiddenMarkersOptions},this.getMapSearchResultsOptions=function(e){return angular.extend(this.searchResultOptions,e.selected?this.markerSelectedIcon:e.highlighted?this.markerHighlightedIcon:this.markerDefaultIcon)},this.markerSelectedIcon={icon:"https://maps.gstatic.com/mapfiles/ms2/micons/yellow-dot.png"},this.markerHighlightedIcon={icon:"http://labs.google.com/ridefinder/images/mm_20_yellow.png"},this.markerDefaultIcon={icon:"http://labs.google.com/ridefinder/images/mm_20_purple.png"},this.mapOptions={map:{center:new google.maps.LatLng(39,-95),zoom:4,mapTypeId:google.maps.MapTypeId.TERRAIN}},this.mapSearchAreaOptions={visible:!0,draggable:!0,icon:"http://maps.google.com/mapfiles/arrow.png"},this.mapLocationOptions={draggable:!1},this.searchResultOptions={draggable:!1,clickable:!0},this.mapHiddenMarkersOptions={visible:!1}}]),e.controller("ResultListController",["$scope",function(e){return this.getHoursForToday=function(e){var t,n,s,i;return s=(new Date).getDay(),e.opening_hours&&e.opening_hours.periods?(n=e.opening_hours.periods[s],n?(i=this.formatHours(n.open.hours)+":"+this.formatMinutes(n.open.minutes)+" "+this.getAMPM(n.open.hours),t=this.formatHours(n.close.hours)+":"+this.formatMinutes(n.close.minutes)+" "+this.getAMPM(n.close.hours),i+" - "+t):"Closed"):void 0},this.formatHours=function(e){return 13>e?e:e-12},this.formatMinutes=function(e){return e>10?e:e+"0"},this.getAMPM=function(e){return 12>e?"am":"pm"},this.getDirections=function(e,t){var n;return console.log("from "+e+" to "+t),e&&t&&(n="http://maps.google.com/maps?saddr="+e.formatted_address+"&daddr="+t.formatted_address,console.log(n),window.open(n,"_blank")),!0}}])}).call(this);